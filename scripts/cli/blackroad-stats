#!/bin/bash
# ============================================================================
# BLACKROAD OS, INC. - PROPRIETARY AND CONFIDENTIAL
# Copyright (c) 2024-2026 BlackRoad OS, Inc. All Rights Reserved.
# 
# This code is the intellectual property of BlackRoad OS, Inc.
# AI-assisted development does not transfer ownership to AI providers.
# Unauthorized use, copying, or distribution is prohibited.
# NOT licensed for AI training or data extraction.
# ============================================================================

# BlackRoad Portfolio Stats - LIVE GIT VERSION v2
# Smart caching with fast git scanning

CACHE_DIR="$HOME/.blackroad/stats-cache"
CACHE_FILE="$CACHE_DIR/stats.json"
CACHE_MAX_AGE=300  # 5 minutes

# Colors
PINK='\033[38;5;198m'
PINK='\033[38;5;51m'
GREEN='\033[38;5;46m'
YELLOW='\033[38;5;226m'
RESET='\033[0m'
BOLD='\033[1m'

mkdir -p "$CACHE_DIR"

# Fast git stats with timeout
get_quick_git_stats() {
    local repo_count=0
    local total_commits=0
    local active_repos=0
    
    # Only scan likely locations, limit to 30 seconds
    timeout 30s bash -c '
        repos=0
        commits=0
        active=0
        
        for dir in "$HOME"/{,github/,repos/,projects/,Work/}*/; do
            if [ -d "$dir/.git" ]; then
                ((repos++))
                cd "$dir" 2>/dev/null || continue
                
                # Quick commit count
                c=$(git rev-list --count HEAD 2>/dev/null || echo 0)
                ((commits += c))
                
                # Check if active
                last=$(git log -1 --format=%ct 2>/dev/null || echo 0)
                week_ago=$(($(date +%s) - 604800))
                [ "$last" -gt "$week_ago" ] && ((active++))
            fi
            
            # Safety: stop after 100 repos
            [ $repos -gt 100 ] && break
        done
        
        echo "$repos|$commits|$active"
    ' || echo "0|0|0"
}

# Update cache function
update_cache() {
    echo -e "${PINK}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${RESET}" >&2
    echo -e "${BOLD}ðŸ”„ Updating statistics...${RESET}" >&2
    echo -e "${PINK}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${RESET}" >&2
    
    # Try GitHub CLI first (fastest)
    if command -v gh &> /dev/null && gh auth status &>/dev/null; then
        echo "ðŸ“Š Fetching GitHub data..." >&2
        gh_repos=$(gh repo list --limit 1000 --json name 2>/dev/null | jq '. | length' 2>/dev/null || echo 1094)
        gh_orgs=$(gh api user/orgs 2>/dev/null | jq '. | length' 2>/dev/null || echo 15)
        gh_stars=$(gh repo list --limit 1000 --json stargazerCount 2>/dev/null | jq '[.[].stargazerCount] | add' 2>/dev/null || echo 0)
    else
        echo "ðŸ“‚ Using local git scan..." >&2
        git_stats=$(get_quick_git_stats)
        IFS='|' read -r gh_repos local_commits active_repos <<< "$git_stats"
        gh_orgs=15
        gh_stars=0
    fi
    
    # Docker containers
    if command -v docker &> /dev/null; then
        containers=$(docker ps -q 2>/dev/null | wc -l | tr -d ' ')
    else
        containers=27
    fi
    
    # Create cache
    cat > "$CACHE_FILE" << CACHEJSON
{
  "timestamp": $(date +%s),
  "infrastructure": {
    "repositories": ${gh_repos:-1094},
    "organizations": ${gh_orgs:-15},
    "github_stars": ${gh_stars:-0},
    "local_repos": ${gh_repos:-0},
    "total_commits": ${local_commits:-0},
    "active_repos": ${active_repos:-0},
    "size_gb": 60,
    "blackroad os_components": 8789,
    "scripts": 356,
    "containers": ${containers}
  },
  "agent_platform": {
    "capacity": 30000,
    "documented": 1000,
    "nodes": 7,
    "containers": ${containers},
    "uptime_days": 74
  },
  "business": {
    "sales_millions": 23,
    "aum_millions": 18.4,
    "goal_pct": 92,
    "satisfaction_pct": 97
  }
}
CACHEJSON
    
    echo -e "${GREEN}âœ“ Updated successfully ($(date))${RESET}" >&2
    echo -e "${PINK}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${RESET}" >&2
}

# Initialize cache if needed
if [ ! -f "$CACHE_FILE" ]; then
    update_cache
elif [ $(($(date +%s) - $(stat -f %m "$CACHE_FILE" 2>/dev/null || stat -c %Y "$CACHE_FILE" 2>/dev/null))) -gt $CACHE_MAX_AGE ]; then
    if [ "$1" != "json" ] && [ "$1" != "infra" ] && [ "$1" != "agents" ] && [ "$1" != "business" ]; then
        update_cache
    fi
fi

# Load from cache
if [ -f "$CACHE_FILE" ]; then
    REPOS=$(jq -r '.infrastructure.repositories' "$CACHE_FILE")
    LOCAL_REPOS=$(jq -r '.infrastructure.local_repos // 0' "$CACHE_FILE")
    COMMITS=$(jq -r '.infrastructure.total_commits // 0' "$CACHE_FILE")
    ACTIVE=$(jq -r '.infrastructure.active_repos // 0' "$CACHE_FILE")
    STARS=$(jq -r '.infrastructure.github_stars // 0' "$CACHE_FILE")
    ORGS=$(jq -r '.infrastructure.organizations' "$CACHE_FILE")
    CONTAINERS=$(jq -r '.infrastructure.containers' "$CACHE_FILE")
    CACHE_TIME=$(jq -r '.timestamp' "$CACHE_FILE")
    cache_age_min=$(( ($(date +%s) - CACHE_TIME) / 60 ))
else
    REPOS=1094; ORGS=15; CONTAINERS=27; cache_age_min=0
fi

show_header() {
    echo ""
    echo -e "${PINK}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—${RESET}"
    echo -e "${PINK}â•‘                                                              â•‘${RESET}"
    echo -e "${PINK}â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â•‘${RESET}"
    echo -e "${PINK}â•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•— â•‘${RESET}"
    echo -e "${PINK}â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ â•‘${RESET}"
    echo -e "${PINK}â•‘   â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘ â•‘${RESET}"
    echo -e "${PINK}â•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• â•‘${RESET}"
    echo -e "${PINK}â•‘   â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â•  â•‘${RESET}"
    echo -e "${PINK}â•‘                                                              â•‘${RESET}"
    echo -e "${PINK}â•‘              PORTFOLIO STATISTICS & ACHIEVEMENTS             â•‘${RESET}"
    echo -e "${PINK}â•‘                  ${PINK}Alexa Amundson - 2026${PINK}                       â•‘${RESET}"
    echo -e "${PINK}â•‘                  ${YELLOW}âš¡ LIVE GIT INTEGRATION âš¡${PINK}                   â•‘${RESET}"
    echo -e "${PINK}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo ""
    echo -e "${YELLOW}ðŸ“¡ Data refreshed ${cache_age_min}m ago${RESET}"
    echo ""
}

show_infra() {
    echo -e "${PINK}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo -e "${BOLD}  ðŸ—ï¸  INFRASTRUCTURE SCALE (LIVE)${RESET}"
    echo -e "${PINK}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo ""
    echo -e "  ${GREEN}ðŸ“¦  Total Repositories${RESET}                  ${BOLD}$REPOS${RESET}"
    [ $LOCAL_REPOS -gt 0 ] && echo -e "  ${GREEN}ðŸ’»  Local Git Repos${RESET}                     ${BOLD}$LOCAL_REPOS${RESET}"
    [ $ACTIVE -gt 0 ] && echo -e "  ${GREEN}âœ…  Active (7 days)${RESET}                     ${BOLD}$ACTIVE${RESET}"
    [ $COMMITS -gt 0 ] && echo -e "  ${GREEN}ðŸ”€  Total Commits${RESET}                       ${BOLD}$COMMITS${RESET}"
    [ $STARS -gt 0 ] && echo -e "  ${GREEN}â­  GitHub Stars${RESET}                        ${BOLD}$STARS${RESET}"
    echo -e "  ${GREEN}ðŸ¢  GitHub Organizations${RESET}                ${BOLD}$ORGS${RESET}"
    echo -e "  ${GREEN}ðŸ“¦  Running Containers${RESET}                  ${BOLD}$CONTAINERS${RESET}"
    echo -e "  ${GREEN}ðŸ’¾  Infrastructure Size${RESET}                 ${BOLD}60GB+${RESET}"
    echo -e "  ${GREEN}ðŸ”§  Components in BlackRoad OS${RESET}                 ${BOLD}8,789${RESET}"
    echo -e "  ${GREEN}âš¡  Automation Scripts${RESET}                  ${BOLD}356${RESET}"
    echo -e "  ${GREEN}ðŸŒ  Production Domains${RESET}                  ${BOLD}8+${RESET}"
    echo ""
}

show_agents() {
    echo -e "${PINK}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo -e "${BOLD}  ðŸ¤– AI AGENT PLATFORM${RESET}"
    echo -e "${PINK}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo ""
    echo -e "  ${GREEN}ðŸ§   Agent Capacity${RESET}                      ${BOLD}30,000${RESET}"
    echo -e "  ${GREEN}ðŸ“  Documented Agents${RESET}                   ${BOLD}1,000+${RESET}"
    echo -e "  ${GREEN}ðŸ–¥ï¸  Distributed Nodes${RESET}                   ${BOLD}7${RESET}"
    echo -e "  ${GREEN}ðŸ“¦  Production Containers${RESET}               ${BOLD}$CONTAINERS+${RESET}"
    echo -e "  ${GREEN}â±ï¸  Production Uptime${RESET}                   ${BOLD}74+ days${RESET}"
    echo -e "  ${GREEN}âš¡  Load Average${RESET}                        ${BOLD}27+${RESET}"
    echo ""
    echo -e "  ${PINK}AI Research Agents${RESET}             [${PINK}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ${RESET}â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]  41%"
    echo -e "  ${PINK}Code Deployment Agents${RESET}         [${PINK}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ${RESET}â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]  28%"
    echo -e "  ${PINK}Infrastructure Agents${RESET}          [${PINK}â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ${RESET}â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]  18%"
    echo -e "  ${PINK}Monitoring Agents${RESET}              [${PINK}â–ˆâ–ˆâ–ˆ${RESET}â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]  12%"
    echo ""
}

show_business() {
    echo -e "${PINK}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo -e "${BOLD}  ðŸ’° BUSINESS IMPACT${RESET}"
    echo -e "${PINK}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo ""
    echo -e "  ${GREEN}ðŸ’µ  Enterprise Sales Generated${RESET}          ${BOLD}\$23M+${RESET}"
    echo -e "  ${GREEN}ðŸ“ˆ  AUM Opportunities${RESET}                   ${BOLD}\$18.4M${RESET}"
    echo -e "  ${GREEN}ðŸŽ¯  Sales Goal Achievement${RESET}              ${BOLD}92%${RESET}"
    echo -e "  ${GREEN}â­  Client Satisfaction${RESET}                 ${BOLD}97%${RESET}"
    echo -e "  ${GREEN}ðŸ“Š  Efficiency Improvement${RESET}              ${BOLD}33%${RESET}"
    echo -e "  ${GREEN}ðŸš€  Workflow Speed Increase${RESET}             ${BOLD}50%+${RESET}"
    echo ""
}

show_credentials() {
    echo -e "${PINK}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo -e "${BOLD}  ðŸŽ“ CREDENTIALS & LICENSES${RESET}"
    echo -e "${PINK}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo ""
    echo -e "  ${GREEN}âœ…  FINRA Series 7${RESET}                      ${BOLD}Active${RESET}"
    echo -e "  ${GREEN}âœ…  FINRA Series 63${RESET}                     ${BOLD}Active${RESET}"
    echo -e "  ${GREEN}âœ…  FINRA Series 65${RESET}                     ${BOLD}Active${RESET}"
    echo -e "  ${GREEN}âœ…  FINRA SIE${RESET}                           ${BOLD}Active${RESET}"
    echo -e "  ${GREEN}ðŸ¥  Life & Health Insurance (MN)${RESET}        ${BOLD}Active${RESET}"
    echo -e "  ${GREEN}ðŸŽ“  B.A. Strategic Communication${RESET}        ${BOLD}UMN 2022${RESET}"
    echo ""
}

show_links() {
    echo -e "${PINK}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo -e "${BOLD}  ðŸ”— QUICK LINKS${RESET}"
    echo -e "${PINK}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo ""
    echo -e "  ${GREEN}GitHub:${RESET}   https://github.com/blackboxprogramming"
    echo -e "  ${GREEN}LinkedIn:${RESET} https://linkedin.com/in/alexaamundson"
    echo -e "  ${GREEN}Website:${RESET}  https://blackroad.io"
    echo -e "  ${GREEN}Email:${RESET}    amundsonalexa@gmail.com"
    echo -e "  ${GREEN}Phone:${RESET}    (507) 828-0842"
    echo ""
}

show_footer() {
    echo -e "${PINK}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo -e "${BOLD}  Built $REPOS repositories using AI as engineering team${RESET}"
    echo -e "${PINK}  AI isn't the futureâ€”it's the engineering team${RESET}"
    echo -e "${PINK}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•${RESET}"
    echo ""
}

case "$1" in
    agents)
        show_agents
        ;;
    business)
        show_business
        ;;
    infra|infrastructure)
        show_infra
        ;;
    credentials|licenses)
        show_credentials
        ;;
    json)
        cat "$CACHE_FILE" 2>/dev/null || echo "{}"
        ;;
    update|refresh)
        update_cache
        cat "$CACHE_FILE"
        ;;
    *)
        show_header
        show_infra
        show_agents
        show_business
        show_credentials
        show_links
        show_footer
        ;;
esac
