name: Ollama Model Sync
on:
  schedule:
    - cron: '0 6 * * *'
  workflow_dispatch:
    inputs:
      model:
        description: Model to pull (e.g. llama3.2:3b)
        default: llama3.2:3b
        required: false
jobs:
  sync-llama:
    runs-on: [self-hosted, blackroad-fleet]
    timeout-minutes: 120
    steps:
      - name: Pull llama3.2
        run: |
          MODEL="${{ github.event.inputs.model }}"
          MODEL="${MODEL:-llama3.2:3b}"
          RUNNER=$(hostname)
          echo "Pulling $MODEL on $RUNNER"
          curl -sf http://localhost:11434/ >/dev/null 2>&1 || (echo "Ollama not running on $RUNNER" && exit 0)
          curl -s -X POST http://localhost:11434/api/pull -H "Content-Type: application/json" -d "{"name":"$MODEL"}" | tail -3
          echo "Done: $MODEL on $RUNNER"
  sync-qwen:
    runs-on: [self-hosted, octavia-pi5]
    timeout-minutes: 120
    if: github.event_name == 'schedule'
    steps:
      - name: Pull qwen2.5:7b on octavia
        run: |
          echo "Pulling qwen2.5:7b on octavia"
          curl -sf http://localhost:11434/ >/dev/null 2>&1 || (echo "Ollama not running" && exit 0)
          curl -s -X POST http://localhost:11434/api/pull -H "Content-Type: application/json" -d "{"name":"qwen2.5:7b"}" | tail -3
          echo "Done: qwen2.5:7b"
