name: üèõÔ∏è Org Cohesion Sync
on:
  schedule:
    - cron: '0 6 * * 1'   # Monday 6am UTC
  workflow_dispatch:

jobs:
  sync-all-orgs:
    name: Sync shared config to all orgs
    runs-on: [self-hosted, pi]
    steps:
      - uses: actions/checkout@v4
        with:
          token: ${{ secrets.GH_PAT }}

      - name: Sync AGENTS.md + brand tokens to all org .github repos
        env:
          GH_TOKEN: ${{ secrets.GH_PAT }}
        run: bash scripts/org-cohesion-sync.sh

      - name: Verify runner labels consistent
        run: |
          echo "Checking runner labels..."
          gh api repos/blackboxprogramming/blackroad/actions/runners \
            --jq '.runners[] | "\(.name): \([.labels[].name] | join(","))"'

      - name: Report
        run: |
          echo "‚úÖ Org cohesion sync complete"
          echo "17 orgs | shared workflows | unified runner labels | agent identities"
