name: HuggingFace Model Registry
on:
  workflow_dispatch:
  schedule:
    - cron: '0 4 * * *'
jobs:
  sync:
    runs-on: [self-hosted, blackroad-fleet]
    steps:
      - uses: actions/checkout@v4
      - name: Sync models
        env:
          HF_TOKEN: ${{ secrets.HUGGINGFACE_TOKEN }}
        run: |
          pip3 install -q huggingface_hub 2>/dev/null || true
          mkdir -p agents/platform-registry
          curl -sf http://localhost:11434/api/tags > agents/platform-registry/ollama-models.json 2>/dev/null || echo '{}' > agents/platform-registry/ollama-models.json
          git config user.email "actions@blackroad.io"
          git config user.name "BlackRoad Actions"
          git add agents/platform-registry/ && git diff --staged --quiet || git commit -m "chore: sync model registry [skip ci]" && git push origin HEAD || true
          echo "done"
