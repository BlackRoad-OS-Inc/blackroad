name: Auto Label

on:
  pull_request:
    types: [opened]

jobs:
  label:
    runs-on: [self-hosted, blackroad-fleet]
    steps:
      - uses: actions/github-script@v8
        with:
          script: |
            const name = context.repo.repo.toLowerCase()
            const labelName = name.includes("lab") ? "labs" : "core"

            // Ensure label exists before applying
            try {
              await github.rest.issues.getLabel({
                ...context.repo,
                name: labelName
              })
            } catch (e) {
              if (e.status === 404) {
                await github.rest.issues.createLabel({
                  ...context.repo,
                  name: labelName,
                  color: labelName === 'labs' ? 'a2eeef' : '0075ca',
                  description: `Auto-label: ${labelName}`
                })
              }
            }

            await github.rest.issues.addLabels({
              ...context.repo,
              issue_number: context.issue.number,
              labels: [labelName]
            })
